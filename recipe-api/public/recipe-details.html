<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Details - Recipe Base</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 
                        primary: '#1a4432', 
                        tertiary: '#266549',
                        secondary: '#2b7156',
                        accent: '#f55b2b',
                        surface: '#e0e0d2',
                        bg: '#fafafa', 
                        border: '#e0e0d2', 
                        text: { main: '#1a4432', muted: '#4a6b5d', light: '#7a9185' } 
                    },
                    fontFamily: { sans: ['DM Sans', 'sans-serif'], display: ['Grenda', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    boxShadow: { 'ceramic': '0 4px 20px -2px rgba(26, 68, 50, 0.05), 0 0 1px rgba(26, 68, 50, 0.1)' }
                }
            }
        }
    </script>
    <style>
        body { background-color: #fafafa; color: #1a4432; overflow-x: hidden; }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.6; pointer-events: none; }
        .hero-overlay { background: linear-gradient(to top, rgba(26,68,50,0.95) 0%, rgba(26,68,50,0.4) 50%, transparent 100%); }
        .card-ceramic { background: #ffffff; border: 1px solid #e0e0d2; border-radius: 1.5rem; box-shadow: 0 4px 20px -2px rgba(26, 68, 50, 0.05); }
        
        /* --- Component System: Buttons --- */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.625rem 1.5rem; border-radius: 9999px; font-family: 'DM Sans', sans-serif; font-size: 0.875rem; font-weight: 500; letter-spacing: 0.01em; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; text-decoration: none; border: 1px solid transparent; }
        .btn-primary { background-color: #1a4432; color: #ffffff; box-shadow: 0 4px 12px rgba(26, 68, 50, 0.15); border-color: transparent; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 16px rgba(26, 68, 50, 0.2); background-color: #143326; }
        .btn-secondary { background-color: #ffffff; color: #1a4432; border-color: #e0e0d2; }
        .btn-secondary:hover { border-color: #1a4432; background-color: #fafafa; transform: translateY(-1px); }
        .btn-outline { background-color: transparent; color: #1a4432; border-color: #1a4432; }
        .btn-outline:hover { background-color: #1a4432; color: #ffffff; transform: translateY(-1px); }
        .btn-glass { background-color: rgba(0, 0, 0, 0.2); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); color: rgba(255, 255, 255, 0.9); border-color: rgba(255, 255, 255, 0.2); }
        .btn-glass:hover { background-color: rgba(0, 0, 0, 0.3); color: #ffffff; border-color: rgba(255, 255, 255, 0.3); transform: translateY(-1px); }

        /* Navbar components reused */
        .btn-ghost { background-color: transparent; color: #4a6b5d; border-color: transparent; padding-left: 1rem; padding-right: 1rem; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.625rem 1.5rem; border-radius: 9999px; font-family: 'DM Sans', sans-serif; font-size: 0.875rem; font-weight: 500; letter-spacing: 0.01em; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; text-decoration: none; border: 1px solid transparent; }
        .btn-ghost:hover { color: #1a4432; background-color: rgba(26, 68, 50, 0.05); }
        .btn-nav-primary { background-color: #1a4432; color: #ffffff; box-shadow: 0 4px 12px rgba(26, 68, 50, 0.1); border-color: transparent; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.625rem 1.5rem; border-radius: 9999px; font-family: 'DM Sans', sans-serif; font-size: 0.875rem; font-weight: 500; letter-spacing: 0.01em; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; text-decoration: none; border: 1px solid transparent; }
        .btn-nav-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 16px rgba(26, 68, 50, 0.15); background-color: #143326; }
    </style>
</head>
<body class="antialiased">
    <canvas id="bg-canvas"></canvas>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 transition-all duration-300 bg-[#fafafa]/90 backdrop-blur-xl border-b border-white/40 shadow-sm" id="navbar">
        <div class="max-w-6xl mx-auto flex justify-between items-center px-6 py-4">
            <a href="/" class="flex items-center gap-2">
                <img src="/logo.svg?v=2" alt="Recipe Base" class="h-6 w-auto">
            </a>
            <div class="hidden md:flex items-center gap-8">
                <a href="/recipes.html" class="text-sm font-bold text-primary border-b-2 border-primary/20 pb-0.5">Recipes</a>
                <a href="/lab.html" class="text-sm font-medium text-text-muted hover:text-primary transition-colors">Nutrition Lab</a>
                <a href="/docs.html" class="text-sm font-medium text-text-muted hover:text-primary transition-colors">API Docs</a>
            </div>
            <div class="flex items-center gap-3">
                <a href="/admin.html" class="hidden md:inline-flex btn-ghost border border-border">Admin</a>
                <a href="/lab.html" class="hidden md:inline-flex btn-nav-primary">Launch App</a>
                <button id="mobile-menu-toggle" class="md:hidden p-2 text-primary"><i data-lucide="menu" class="w-6 h-6"></i></button>
            </div>
        </div>
    </nav>

    <div id="mobile-menu" class="fixed inset-0 z-[60] bg-[#fafafa] transform translate-x-full transition-transform duration-300 flex flex-col justify-center items-center gap-8 md:hidden">
        <button id="mobile-menu-close" class="absolute top-6 right-6 text-primary p-2"><i data-lucide="x" class="w-8 h-8"></i></button>
        <a href="/" class="font-display text-3xl font-medium text-primary">Home</a>
        <a href="/recipes.html" class="font-display text-3xl font-medium text-primary">Recipes</a>
        <a href="/lab.html" class="font-display text-3xl font-medium text-primary">Nutrition Lab</a>
        <a href="/docs.html" class="font-display text-3xl font-medium text-primary">API Docs</a>
    </div>

    <div id="recipeContainer" class="min-h-screen pt-16">
        <div class="h-screen flex items-center justify-center text-primary/60 animate-pulse font-display text-xl">Loading recipe...</div>
    </div>

    <script>
        lucide.createIcons();
        const API_URL = ''; 

        async function fetchRecipeDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            if (!id) { document.getElementById('recipeContainer').innerHTML = '<div class="h-screen flex items-center justify-center text-red-800">No ID provided.</div>'; return; }
            try {
                const res = await fetch(`${API_URL}/recipes/${id}`);
                if (res.status === 404) { document.getElementById('recipeContainer').innerHTML = '<div class="h-screen flex items-center justify-center text-text-muted">Recipe not found.</div>'; return; }
                const recipe = await res.json();
                renderRecipe(recipe);
            } catch (err) { document.getElementById('recipeContainer').innerHTML = '<div class="h-screen flex items-center justify-center text-red-800">Failed to load.</div>'; }
        }

        function renderRecipe(recipe) {
            const container = document.getElementById('recipeContainer');
            const imageUrl = recipe.image || 'https://via.placeholder.com/1200x600?text=No+Image';
            const prep = formatDuration(recipe.prep_time);
            const cook = formatDuration(recipe.cook_time);
            const yieldInfo = recipe.recipe_yield || '';
            const meta = [prep ? `Prep: ${prep}` : null, cook ? `Cook: ${cook}` : null, yieldInfo ? `Yields: ${yieldInfo}` : null].filter(Boolean).join('  â€¢  ');

            let ingredientsHtml = '<p class="opacity-60 italic">No ingredients listed.</p>';
            if (Array.isArray(recipe.recipe_ingredients)) {
                ingredientsHtml = `<ul class="space-y-3 text-sm leading-relaxed text-text-main">${recipe.recipe_ingredients.map(i => `<li class="flex items-start gap-3 pb-3 border-b border-border last:border-0"><div class="w-1.5 h-1.5 rounded-full bg-primary/40 mt-2 shrink-0"></div><span>${i}</span></li>`).join('')}</ul>`;
            }

            let instructionsHtml = '<p class="opacity-60 italic">No instructions listed.</p>';
            if (Array.isArray(recipe.recipe_instructions)) {
                instructionsHtml = `<div class="space-y-8">${recipe.recipe_instructions.map((step, idx) => {
                    const text = typeof step === 'object' ? (step.text || step.name || JSON.stringify(step)) : step;
                    return `<div class="group"><span class="font-display text-2xl text-primary/20 group-hover:text-primary/40 transition-colors mb-2 block font-bold">${String(idx + 1).padStart(2, '0')}</span><p class="text-text-main leading-relaxed text-base md:text-lg">${text}</p></div>`;
                }).join('')}</div>`;
            }

            container.innerHTML = `
                <div class="relative h-[50vh] md:h-[60vh] w-full bg-primary">
                    <img src="${imageUrl}" class="w-full h-full object-cover opacity-90" alt="${recipe.name}">
                    <div class="absolute inset-0 hero-overlay"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-6 md:p-12 max-w-6xl mx-auto">
                        <div class="max-w-4xl">
                            <span class="text-white/80 uppercase tracking-[0.2em] text-xs font-bold mb-3 block">Recipe</span>
                            <h1 class="font-display text-3xl sm:text-4xl md:text-6xl text-white leading-[1.1] mb-6 shadow-sm break-words">${recipe.name}</h1>
                            <div class="flex items-center gap-6 text-white/90 font-mono text-xs uppercase tracking-wider border-t border-white/20 pt-4 inline-block">
                                ${meta}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="max-w-6xl mx-auto px-6 md:px-12 py-12 md:py-20">
                    ${recipe.description ? `<div class="max-w-3xl mb-16"><p class="font-display text-xl md:text-2xl text-primary leading-relaxed opacity-90 italic">"${recipe.description}"</p></div>` : ''}
                    <div class="grid lg:grid-cols-12 gap-10 lg:gap-16">
                        <div class="lg:col-span-4">
                            <div class="card-ceramic p-8 sticky top-24">
                                <h3 class="font-display text-xl text-primary mb-6 pb-3 border-b border-border font-medium">Ingredients</h3>
                                ${ingredientsHtml}
                            </div>
                        </div>
                        <div class="lg:col-span-8 lg:pl-4">
                            <h3 class="font-display text-2xl text-primary mb-8 font-medium">Method</h3>
                            ${instructionsHtml}
                            <div class="mt-16 pt-8 border-t border-border text-center">
                                <a href="${recipe.url}" target="_blank" class="btn btn-outline">View Original Source <i data-lucide="external-link" class="w-4 h-4"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function formatDuration(iso) { if (!iso) return ''; return iso.replace('PT', '').replace('H', 'h ').replace('M', 'm').toLowerCase(); }
        
        class GodRaysBackground { constructor(canvasId, color1, color2, speed=0.002) { this.canvas = document.getElementById(canvasId); if (!this.canvas) return; this.renderer = new THREE.WebGLRenderer({ canvas: this.canvas, alpha: true }); this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); this.scene = new THREE.Scene(); this.camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1); this.uniforms = { uTime: { value: 0 }, uResolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) }, uColor1: { value: new THREE.Color(color1) }, uColor2: { value: new THREE.Color(color2) } }; this.scene.add(new THREE.Mesh(new THREE.PlaneGeometry(2, 2), new THREE.ShaderMaterial({ uniforms: this.uniforms, vertexShader: `varying vec2 vUv; void main() { vUv = uv; gl_Position = vec4(position, 1.0); }`, fragmentShader: `uniform float uTime; uniform vec2 uResolution; uniform vec3 uColor1; uniform vec3 uColor2; varying vec2 vUv; vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; } vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; } vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); } float snoise(vec2 v) { const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439); vec2 i  = floor(v + dot(v, C.yy)); vec2 x0 = v - i + dot(i, C.xx); vec2 i1; i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0); vec4 x12 = x0.xyxy + C.xxzz; x12.xy -= i1; i = mod(i, 289.0); vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 )); vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0); m = m*m ; m = m*m ; vec3 x = 2.0 * fract(p * C.www) - 1.0; vec3 h = abs(x) - 0.5; vec3 ox = floor(x + 0.5); vec3 a0 = x - ox; m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h ); vec3 g; g.x  = a0.x  * x0.x  + h.x  * x0.y; g.yz = a0.yz * x12.xz + h.yz * x12.yw; return 130.0 * dot(m, g); } float fbm(vec2 st) { float v = 0.0; float a = 0.5; for (int i = 0; i < 3; i... [truncated]
        
        fetchRecipeDetails();
    </script>
</body>
</html>